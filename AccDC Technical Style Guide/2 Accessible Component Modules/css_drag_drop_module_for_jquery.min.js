/*
CSS Drag and Drop Module R2.2 for jQuery
Copyright 2010-2013 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
	*/
(function(){(function(a){(function(f){f.fn.drag=function(l,h,k){var j=typeof l=="string"?l:"",i=f.isFunction(l)?l:f.isFunction(h)?h:null;if(j.indexOf("drag")!==0){j="drag"+j}k=(l==i?h:k)||{};return i?this.bind(j,k,i):this.trigger(j)};var c=f.event,b=c.special,e=b.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:false,drop:true,click:false},datakey:"dragdata",noBubble:true,add:function(j){var i=f.data(this,e.datakey),h=j.data||{};i.related+=1;f.each(e.defaults,function(k,l){if(h[k]!==undefined){i[k]=h[k]}})},remove:function(){f.data(this,e.datakey).related-=1},setup:function(){if(f.data(this,e.datakey)){return}var h=f.extend({related:0},e.defaults);f.data(this,e.datakey,h);c.add(this,"touchstart mousedown",e.init,h);if(this.attachEvent){this.attachEvent("ondragstart",e.dontstart)}},teardown:function(){var h=f.data(this,e.datakey)||{};if(h.related){return}f.removeData(this,e.datakey);c.remove(this,"touchstart mousedown",e.init);e.textselect(true);if(this.detachEvent){this.detachEvent("ondragstart",e.dontstart)}},init:function(j){if(e.touched){return}var h=j.data,i;if(j.which!=0&&h.which>0&&j.which!=h.which){return}if(f(j.target).is(h.not)){return}if(h.handle&&!f(j.target).closest(h.handle,j.currentTarget).length){return}e.touched=j.type=="touchstart"?this:null;h.propagates=1;h.mousedown=this;h.interactions=[e.interaction(this,h)];h.target=j.target;h.pageX=j.pageX;h.pageY=j.pageY;h.dragging=null;i=e.hijack(j,"draginit",h);if(!h.propagates){return}i=e.flatten(i);if(i&&i.length){h.interactions=[];f.each(i,function(){h.interactions.push(e.interaction(this,h))})}h.propagates=h.interactions.length;if(h.drop!==false&&b.drop){b.drop.handler(j,h)}e.textselect(false);if(e.touched){c.add(e.touched,"touchmove touchend",e.handler,h)}else{c.add(document,"mousemove mouseup",e.handler,h)}if(!e.touched||h.live){return false}},interaction:function(j,i){var k=$A.xOffset(j),h=$A.css(j,"position");if(h=="fixed"){k.top=j.offsetTop}else{if(i.relative||h=="relative"){k=$A.xOffset(j,null,true)}}return{drag:j,callback:new e.callback(),droppable:[],offset:k}},handler:function(i){var h=i.data;switch(i.type){case !h.dragging&&"touchmove":i.preventDefault();case !h.dragging&&"mousemove":if(Math.pow(i.pageX-h.pageX,2)+Math.pow(i.pageY-h.pageY,2)<Math.pow(h.distance,2)){break}i.target=h.target;e.hijack(i,"dragstart",h);if(h.propagates){h.dragging=true}case"touchmove":i.preventDefault();case"mousemove":if(h.dragging){e.hijack(i,"drag",h);if(h.propagates){if(h.drop!==false&&b.drop){b.drop.handler(i,h)}break}i.type="mouseup"}case"touchend":case"mouseup":default:if(e.touched){c.remove(e.touched,"touchmove touchend",e.handler)}else{c.remove(document,"mousemove mouseup",e.handler)}if(h.dragging){if(h.drop!==false&&b.drop){b.drop.handler(i,h)}e.hijack(i,"dragend",h)}e.textselect(true);if(h.click===false&&h.dragging){f.data(h.mousedown,"suppress.click",new Date().getTime()+5)}h.dragging=e.touched=false;break}},hijack:function(j,p,s,q,l){if(!s){return}var r={event:j.originalEvent,type:j.type},n=p.indexOf("drop")?"drag":"drop",u,m=q||0,k,h,t,o=!isNaN(q)?q:s.interactions.length;j.type=p;j.originalEvent=null;s.results=[];do{if(k=s.interactions[m]){if(p!=="dragend"&&k.cancelled){continue}t=e.properties(j,s,k);k.results=[];f(l||k[n]||s.droppable).each(function(v,i){t.target=i;j.isPropagationStopped=function(){return false};u=i?c.handle.call(i,j,t):null;if(u===false){if(n=="drag"){k.cancelled=true;s.propagates-=1}if(p=="drop"){k[n][v]=null}}else{if(p=="dropinit"){k.droppable.push(e.element(u)||i)}}if(p=="dragstart"){k.proxy=f(e.element(u)||k.drag)[0]}k.results.push(u);delete j.result;if(p!=="dropinit"){return u}});s.results[m]=e.flatten(k.results);if(p=="dropinit"){k.droppable=e.flatten(k.droppable)}if(p=="dragstart"&&!k.cancelled){t.update()}}}while(++m<o);j.type=r.type;j.originalEvent=r.event;return e.flatten(s.results)},properties:function(j,h,i){var k=i.callback;k.drag=i.drag;k.proxy=i.proxy||i.drag;k.startX=h.pageX;k.startY=h.pageY;k.deltaX=j.pageX-h.pageX;k.deltaY=j.pageY-h.pageY;k.originalX=i.offset.left;k.originalY=i.offset.top;k.offsetX=k.originalX+k.deltaX;k.offsetY=k.originalY+k.deltaY;k.drop=e.flatten((i.drop||[]).slice());k.available=e.flatten((i.droppable||[]).slice());return k},element:function(h){if(h&&(h.pL||h.nodeType==1)){return h}},flatten:function(h){return f.map(h,function(i){return i&&i.pL?f.makeArray(i):i&&i.length?e.flatten(i):i})},textselect:function(h){f(document)[h?"unbind":"bind"]("selectstart",e.dontstart);$A.css(document,"MozUserSelect",h?"":"none");document.unselectable=(h?"off":"on")},dontstart:function(){return false},callback:function(){}};e.callback.prototype={update:function(){if(b.drop&&this.available.length){f.each(this.available,function(h){b.drop.locate(this,h)})}}};var g=c.dispatch;c.dispatch=function(h){if(f.data(this,"suppress."+h.type)-new Date().getTime()>0){f.removeData(this,"suppress."+h.type);return}return g.apply(this,arguments)};var d=c.fixHooks.touchstart=c.fixHooks.touchmove=c.fixHooks.touchend=c.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(i,j){if(j){var h=(j.touches&&j.touches[0])||(j.changedTouches&&j.changedTouches[0])||null;if(h){f.each(d.props,function(k,l){i[l]=h[l]})}}return i}};b.draginit=b.dragstart=b.dragend=e})(a);(function(e){var c=e.event,d=c.special.drag,b=d.add,f=d.teardown;d.noBubble=false;d.livekey="livedrag";d.add=function(h){b.apply(this,arguments);var g=e.data(this,d.datakey);if(!g.live&&h.selector){g.live=true;c.add(this,"draginit."+d.livekey,d.delegate)}};d.teardown=function(){f.apply(this,arguments);var g=e.data(this,d.datakey)||{};if(g.live){c.remove(this,"draginit."+d.livekey,d.delegate);g.live=false}};d.delegate=function(i){var g=[],j,h=e.data(this,"events")||{};e.each(h||[],function(l,k){if(l.indexOf("drag")!==0){return}e.each(k||[],function(m,n){j=e(i.target).closest(n.selector,i.currentTarget)[0];if(!j){return}c.add(j,n.origType+"."+d.livekey,n.origHandler||n.handler,n.data);if(e.inArray(j,g)<0){g.push(j)}})});if(!g.length){return false}return e(g).bind("dragend."+d.livekey,function(){c.remove(this,"."+d.livekey)})}})(a);(function(e){e.fn.drop=function(j,f,i){var h=typeof j=="string"?j:"",g=e.isFunction(j)?j:e.isFunction(f)?f:null;if(h.indexOf("drop")!==0){h="drop"+h}i=(j==g?f:i)||{};return g?this.bind(h,i,g):this.trigger(h)};e.drop=function(f){f=f||{};c.multi=f.multi===true?Infinity:f.multi===false?1:!isNaN(f.multi)?f.multi:c.multi;c.delay=f.delay||c.delay;c.tolerance=e.isFunction(f.tolerance)?f.tolerance:f.tolerance===null?null:c.tolerance;c.mode=f.mode||c.mode||"overlap"};var d=e.event,b=d.special,c=e.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:true,add:function(g){var f=e.data(this,c.datakey);f.related+=1},remove:function(){e.data(this,c.datakey).related-=1},setup:function(){if(e.data(this,c.datakey)){return}var f={related:0,active:[],anyactive:0,winner:0,location:{}};e.data(this,c.datakey,f);c.targets.push(this)},teardown:function(){var g=e.data(this,c.datakey)||{};if(g.related){return}e.removeData(this,c.datakey);var f=this;c.targets=e.grep(c.targets,function(h){return(h!==f)})},handler:function(h,f){var g,i;if(!f){return}switch(h.type){case"mousedown":case"touchstart":i=e(c.targets);if(typeof f.drop=="string"){i=i.filter(f.drop)}i.each(function(){var j=e.data(this,c.datakey);j.active=[];j.anyactive=0;j.winner=0});f.droppable=i;b.drag.hijack(h,"dropinit",f);break;case"mousemove":case"touchmove":c.event=h;if(!c.timer){c.tolerate(f)}break;case"mouseup":case"touchend":c.timer=clearTimeout(c.timer);if(f.propagates){b.drag.hijack(h,"drop",f);b.drag.hijack(h,"dropend",f)}break}},locate:function(l,i){var m=e.data(l,c.datakey),j=$A.xOffset(l),g=$A.xHeight(l),k=$A.xWidth(l),f=$A.css(l,"position");if(f=="fixed"){j.top=l.offsetTop}else{if(f=="relative"){j=$A.xOffset(l,null,true)}}var h={elem:l,width:k,height:g,top:j.top,left:j.left,right:j.left+k,bottom:j.top+g};if(m){m.location=h;m.index=i;m.elem=l}return h},contains:function(f,g){return((g[0]||g.left)>=f.left&&(g[0]||g.right)<=f.right&&(g[1]||g.top)>=f.top&&(g[1]||g.bottom)<=f.bottom)},modes:{intersect:function(g,f,h){return this.contains(h,[g.pageX,g.pageY])?1000000000:this.modes.overlap.apply(this,arguments)},overlap:function(g,f,h){return Math.max(0,Math.min(h.bottom,f.bottom)-Math.max(h.top,f.top))*Math.max(0,Math.min(h.right,f.right)-Math.max(h.left,f.left))},fit:function(g,f,h){return this.contains(h,f)?1:0},middle:function(g,f,h){return this.contains(h,[f.left+f.width*0.5,f.top+f.height*0.5])?1:0}},sort:function(g,f){return(f.winner-g.winner)||(g.index-f.index)},tolerate:function(r){var l,f,o,k,m,n,h,q=0,g,j=r.interactions.length,s=[c.event.pageX,c.event.pageY],p=c.tolerance||c.modes[c.mode];do{if(g=r.interactions[q]){if(!g){return}g.drop=[];m=[];n=g.droppable.length;if(p){o=c.locate(g.proxy)}l=0;do{if(h=g.droppable[l]){k=e.data(h,c.datakey);f=k.location;if(!f){continue}k.winner=p?p.call(c,c.event,o,f):c.contains(f,s)?1:0;m.push(k)}}while(++l<n);m.sort(c.sort);l=0;do{if(k=m[l]){if(k.winner&&g.drop.length<c.multi){if(!k.active[q]&&!k.anyactive){if(b.drag.hijack(c.event,"dropstart",r,q,k.elem)[0]!==false){k.active[q]=1;k.anyactive+=1}else{k.winner=0}}if(k.winner){g.drop.push(k.elem)}}else{if(k.active[q]&&k.anyactive==1){b.drag.hijack(c.event,"dropend",r,q,k.elem);k.active[q]=0;k.anyactive-=1}}}}while(++l<n)}}while(++q<j);if(c.last&&s[0]==c.last.pageX&&s[1]==c.last.pageY){delete c.timer}else{c.timer=setTimeout(function(){c.tolerate(r)},c.delay)}c.last=c.event}};b.dropinit=b.dropstart=b.dropend=c})(a);(function(e){var d=e.event,b=d.special.drop,c=b.add,f=b.teardown;b.noBubble=false;b.livekey="livedrop";b.add=function(h){c.apply(this,arguments);var g=e.data(this,b.datakey);if(!g.live&&h.selector){g.live=true;d.add(this,"dropinit."+b.livekey,b.delegate)}};b.teardown=function(){f.apply(this,arguments);var g=e.data(this,b.datakey)||{};if(g.live){d.remove(this,"dropinit",b.delegate);g.live=false}};b.delegate=function(j,g){var h=[],k,i=e.data(this,"events")||{};e.each(i||[],function(m,l){if(m.indexOf("drop")!==0){return}e.each(l,function(n,o){k=e(j.currentTarget).find(o.selector);if(!k.length){return}k.each(function(){d.add(this,o.origType+"."+b.livekey,o.origHandler||o.handler,o.data);if(e.inArray(this,h)<0){h.push(this)}})})});if(g){d.add(g.drag,"dragend."+b.livekey,function(){e.each(h.concat(this),function(){d.remove(this,"."+b.livekey)})})}return h.length?e(h):false}})(a)})($A.internal);$A.setDragAndDrop=function(c){var f="tmp"+$A.genId(),d=c.ddCSS||{},e=c.cssObj||{},b=c.on||{},a=c.root||document;$A.query(c.setDrag,a,function(g,h){$A.morph(h,{id:f+g,role:c.setName(h),showHiddenBounds:false,showHiddenClose:false,original:h,isDraggable:true,drag:{confineTo:c.confineTo},accDD:{on:true,dragText:c.dragText||"Drag",dropText:c.dropText||"Drop",actionText:c.actionText||"Dragging",dragLinkStyle:d,dropLinkStyle:d,dragClassName:c.dragClassName||"",dropClassName:c.dropClassName||"",dropAnchor:c.dropAnchor||"",duration:c.duration||1000},onDragStart:c.on.dragStart,onDrag:c.on.drag,onDropStart:c.on.dropStart,onDrop:c.on.drop,onDropEnd:c.on.dropEnd,onDragEnd:c.on.dragEnd,dropTarget:c.setDrop,cssObj:e,displayInline:c.displayInline||false,runBefore:function(i){if(c.runBefore){c.runBefore.apply(i,[i])}},runAfter:function(i){if(c.runAfter){c.runAfter.apply(i,[i])}}})})}})();