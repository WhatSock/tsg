/*!
ARIA Listbox Generator Module R2.9
Copyright 2019 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
	*/
$A.Listbox=function(l,p){function d(t){return t&&"object"==typeof t&&"number"==typeof t.length&&"function"==typeof t.splice&&!t.propertyIsEnumerable("length")}var e=(p=p||{}).grabInstruct||"Press Space to grab",i=p.dropInstruct||"Press Space to drop",t=p.grabMsg||"Grabbed",n=p.dropMsg||"Moved",a=p.cancelDrop||"Grab canceled",u=(l="string"==typeof l?$A.getEl(l):l,this);function f(t,e){t==u.index&&!e||$A.query("#"+l.id+" > li > a",function(t,e){$A.setAttr(e,{tabindex:"-1"}),p.isMultiselect||$A.setAttr(e,{"aria-selected":"false"})}),u.options[t]&&($A.setAttr(u.options[t],{tabindex:"0"}),p.isMultiselect||$A.setAttr(u.options[t],{"aria-selected":"true"}),u.options[t].scrollIntoView(),u.index=t,u.grabbed=$,e&&u.options[t].focus(),p.isMultiselect||(h=u.options[t].id),p.callback&&"function"==typeof p.callback&&setTimeout(function(){p.callback.apply(u,[u.options[t],u.options])},1))}function r(){for(id in h=[],b)b[id]&&h.push(id)}function c(t){$A.query("#"+l.id+" > li > a",function(t,e){$A.remAttr(e,"aria-dropeffect"),$A.setAttr(e,"aria-grabbed","false")}),t?$A.announce(a):(l.insertBefore(u.options[A[$]].parentNode,u.options[u.index].parentNode),m(!0),$A.announce(n));var e=$;$="",f(t?u.index:A[e],!t)}function o(t,e){if(u.options.length){$&&c.apply(this,[!0]);for(var i=d(t),n=i?t:[t],a=[],r=0;r<n.length;r++){var o=u.options[n[r]];$A.unbind(o,".arialistbox");var s=o.parentNode;a.push(s.removeChild(o)),l.removeChild(s)}return h=p.isMultiselect?[]:"",m(),u.index>g&&(u.index=g),u.options.length&&f(u.options[u.index]?u.index:0,!e),i?a:a[0]}}function s(){p.isSortable?$?c.apply(this):function(){$A.query("#"+l.id+" > li > a",function(t,e){$A.remAttr(e,"aria-grabbed"),$A.setAttr(e,"aria-dropeffect","move")}),$=this.id,$A.setAttr(this,"aria-grabbed","true"),$A.remAttr(this,"aria-dropeffect"),f(A[$]),$A.announce(t)}.apply(this):p.isMultiselect&&(b[this.id]=!b[this.id],$A.setAttr(this,"aria-selected",b[this.id]?"true":"false"),r(),f(u.index))}u.index=isNaN(p.defaultIndex)?0:p.defaultIndex;var A={},b={},g=0,h=p.isMultiselect?[]:"",$="",v=function(t){t||($A.unbind(l,"focusin.arialistbox"),$A.bind(l,"focusin.arialistbox",function(){p.isSortable&&$A.announce($?i:e,!0)})),$A.unbind(t||"#"+l.id+" > li > a","click keydown"),$A.bind(t||"#"+l.id+" > li > a",{"click.arialistbox":function(t){t.preventDefault(),p.isSortable?(f(A[this.id]),s.apply(this)):p.isMultiselect&&(b[this.id]=!b[this.id],$A.setAttr(this,"aria-selected",b[this.id]?"true":"false"),r()),f(A[this.id])},"keydown.arialistbox":function(t){var e=t.which||t.keyCode;if(13==e)$A.trigger(this,"click"),t.stopPropagation(),t.preventDefault();else if(27==e&&$)c.apply(this,[!0]),t.stopPropagation(),t.preventDefault();else if(32==e)s.apply(this),t.stopPropagation(),t.preventDefault();else if(38==e)t.preventDefault(),t.stopPropagation(),0<u.index&&f(u.index-1,!0);else if(40==e)t.preventDefault(),t.stopPropagation(),u.index<g&&f(u.index+1,!0);else if(35==e)t.preventDefault(),t.stopPropagation(),f(g,!0);else if(36==e)t.preventDefault(),t.stopPropagation(),f(0,!0);else if(33==e){t.preventDefault(),t.stopPropagation();var i=u.index-parseInt(g*(20<=g?.1:.5));u.index!=i&&f(0<i?i:0,!0)}else 34==e?(t.preventDefault(),t.stopPropagation(),i=u.index+parseInt(g*(20<=g?.1:.5)),u.index!=i&&f(i<g?i:g,!0)):46==e&&p.allowDelete?(t.preventDefault(),t.stopPropagation(),o(A[this.id])):(48<=e&&e<=57||65<=e&&e<=90)&&(y(String.fromCharCode(e)),t.stopPropagation(),t.preventDefault())}})},x=[],y=function(t){for(var e=u.index+1;e<=g;e++)if(t.toLowerCase()==x[e].replace(/^\s+|\s+$/g,"").substring(0,1).toLowerCase())return void f(e,!0);for(e=0;e<u.index;e++)if(t.toLowerCase()==x[e].replace(/^\s+|\s+$/g,"").substring(0,1).toLowerCase())return void f(e,!0)},m=function(i){A={},x=[],b={},g=0;var n=[];u.options=$A.query("#"+l.id+" > li > a",function(t,e){A[e.id]=t,x.push($A.getText(e)),p.isMultiselect&&(b[e.id]=!1),g=t,i||$A.setAttr(e,{tabindex:"-1","aria-selected":"false"}),$A.setAttr(e,"aria-posinset",t+1),i||!p.isSortable&&!p.isMultiselect||$A.setAttr(e,p.isSortable?"aria-grabbed":"aria-selected","false"),e.id&&n.push(e.id)}),n.length&&$A.setAttr(l,"aria-owns",n.join(" ")),$A.query("#"+l.id+" > li > a",function(t,e){$A.setAttr(e,"aria-setsize",g+1)}),(1===u.options.length||u.empty&&0<u.options.length)&&f(0),u.empty=!1};p.isMultiselect&&$A.setAttr(l,"aria-multiselectable","true"),p.label&&$A.setAttr(l,"aria-label",p.label),m(),v(),u.val=function(i){if("number"==typeof i)f(i);else if(i&&"string"==typeof i)f(A[i]);else{if(!(i&&d(i)&&p.isMultiselect))return h;function t(t){for(var e=0;e<i.length;e++)if(i[e]==t)return!0;return!1}for(var e=0;e<u.options.length;e++)(t(u.options[e].id)&&"true"!=$A.getAttr(u.options[e],"aria-selected")||!t(u.options[e].id)&&"false"!=$A.getAttr(u.options[e],"aria-selected")||!i.length&&"false"!=$A.getAttr(u.options[e],"aria-selected"))&&s.apply(u.options[e])}},u.add=function(t){if(u.options.length||(u.empty=!0),t){$&&c.apply(this,[!0]);for(var e=d(t)?t:[t],i=u.options.length,n=0;n<e.length;n++){t=e[n];var a=$A.createEl("li");if(!t||1!==t.nodeType||!t.id)return;$A.setAttr(t,{role:"option",tabindex:"-1","aria-selected":"false"}),(p.isSortable||p.isMultiselect)&&$A.setAttr(t,p.isSortable?"aria-grabbed":"aria-selected","false"),a.appendChild(t),l.appendChild(a),v(t)}m(!0),i<u.options.length&&f(i)}},u.rem=function(t){for(var e=d(t),i=e?t:[t],n=[],a=0;a<i.length;a++)n.push(i[a]?o(i[a]&&"string"==typeof i[a]?A[i[a]]:i[a],!0):null);return e?n:n[0]},u.activate=s,u.grabbed=$,u.container=l,u.val(u.index)};