/*!
CSS Drag and Drop Module R2.5 for AccDC Standalone, Dojo, and MooTools
(Requires AccDC API version 3.4+> )
Copyright 2010-2017 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
*/
!function(){var a,i,o,d,n,t,s,c,l,r,g;(function(p){p.fn.drag=function(e,t,a){var n="string"==typeof e?e:"",r=p.isFunction(e)?e:p.isFunction(t)?t:null;return 0!==n.indexOf("drag")&&(n="drag"+n),a=(e==r?t:a)||{},r?this.bind(n,a,r):this.trigger(n),this};var f=p.event,i=f.special,u=i.drag={defaults:{which:1,distance:0,not:"input, textarea, select, button",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",livekey:"livedrag",add:function(e){var a=p.data(this,u.datakey),n=e.data||{};a.related+=1,!a.live&&e.selector&&(a.live=!0,f.add(this,"draginit."+u.livekey,u.delegate)),p.each(u.defaults,function(e,t){void 0!==n[e]&&(a[e]=n[e])})},remove:function(){p.data(this,u.datakey).related-=1},setup:function(){if(!p.data(this,u.datakey)){var e=p.extend({related:0},u.defaults);p.data(this,u.datakey,e),f.add(this,"touchstart mousedown",u.init,e),this.attachEvent&&this.attachEvent("ondragstart",u.dontstart)}},teardown:function(){p.data(this,u.datakey).related||(p.removeData(this,u.datakey),f.remove(this,"touchstart mousedown",u.init),f.remove(this,"draginit",u.delegate),u.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",u.dontstart))},init:function(e){if(!u.touched){var t,a=e.data;if(!(0!=e.which&&0<a.which&&e.which!=a.which)){if(a.not)for(var n=$A.query(a.not,e.target.parentNode),r=0;r<n.length;r++)if(e.target==n[r])return;if((!a.handle||p(e.target).closest(a.handle,e.currentTarget).length)&&(u.touched="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints?this:null,a.propagates=1,a.interactions=[u.interaction(this,a)],a.target=e.target,a.pageX=e.pageX,a.pageY=e.pageY,a.dragging=null,t=u.hijack(e,"draginit",a),a.propagates))return(t=u.flatten(t))&&t.length&&(a.interactions=[],p.each(t,function(){a.interactions.push(u.interaction(this,a))})),a.propagates=a.interactions.length,!1!==a.drop&&i.drop&&i.drop.handler(e,a),u.textselect(!1),u.touched?f.add(u.touched,"touchmove touchend",u.handler,a):f.add(document,"mousemove mouseup",u.handler,a),!(!u.touched||a.live)&&void 0}}},interaction:function(e,t){var a=$A.xOffset(e);return{drag:e,callback:new u.callback,droppable:[],offset:a}},handler:function(e){var t=e.data;switch(e.type){case!t.dragging&&"touchmove":e.preventDefault();case!t.dragging&&"mousemove":if(Math.pow(e.pageX-t.pageX,2)+Math.pow(e.pageY-t.pageY,2)<Math.pow(t.distance,2))break;e.target=t.target,u.hijack(e,"dragstart",t),t.propagates&&(t.dragging=!0);case"touchmove":e.preventDefault();case"mousemove":if(t.dragging){if(u.hijack(e,"drag",t),t.propagates){!1!==t.drop&&i.drop&&i.drop.handler(e,t);break}e.type="mouseup"}case"touchend":case"mouseup":u.touched?f.remove(u.touched,"touchmove touchend",u.handler):f.remove(document,"mousemove mouseup",u.handler),t.dragging&&(!1!==t.drop&&i.drop&&i.drop.handler(e,t),u.hijack(e,"dragend",t)),u.textselect(!0),!1===t.click&&t.dragging&&(a.event.triggered=!0,setTimeout(function(){a.event.triggered=!1},20),t.dragging=!1),u.touched=!1}},delegate:function(a){var n,r=[],e=p.data(this,"events")||{};return p.each(e.live||[],function(e,t){0===t.preType.indexOf("drag")&&(n=p(a.target).closest(t.selector,a.currentTarget)[0])&&(f.add(n,t.origType+"."+u.livekey,t.origHandler,t.data),p.inArray(n,r)<0&&r.push(n))}),!!r.length&&p(r).bind("dragend."+u.livekey,function(){f.remove(this,"."+u.livekey)})},hijack:function(a,n,r,e,t){if(r){var i,o,d,s={event:a.originalEvent,type:a.type},c=n.indexOf("drop")?"drag":"drop",l=e||0,g=isNaN(e)?r.interactions.length:e;a.type=n,a.originalEvent=null,r.results=[];do{if(o=r.interactions[l]){if("dragend"!==n&&o.cancelled)continue;d=u.properties(a,r,o),o.results=[],p(t||o[c]||r.droppable).each(function(e,t){if(d.target=t,!(a.isPropagationStopped=function(){return!1})===(i=t?f.handle.call(t,a,d):null)?("drag"==c&&(o.cancelled=!0,r.propagates-=1),"drop"==n&&(o[c][e]=null)):"dropinit"==n&&o.droppable.push(u.element(i)||t),"dragstart"==n&&(o.proxy=p(u.element(i)||o.drag)[0]),o.results.push(i),delete a.result,"dropinit"!==n)return i}),r.results[l]=u.flatten(o.results),"dropinit"==n&&(o.droppable=u.flatten(o.droppable)),"dragstart"!=n||o.cancelled||d.update()}}while(++l<g);return a.type=s.type,a.originalEvent=s.event,u.flatten(r.results)}},properties:function(e,t,a){var n=a.callback;return n.drag=a.drag,n.proxy=a.proxy||a.drag,n.startX=t.pageX,n.startY=t.pageY,n.deltaX=e.pageX-t.pageX,n.deltaY=e.pageY-t.pageY,n.originalX=a.offset.left,n.originalY=a.offset.top,n.offsetX=n.originalX+n.deltaX,n.offsetY=n.originalY+n.deltaY,n.drop=u.flatten((a.drop||[]).slice()),n.available=u.flatten((a.droppable||[]).slice()),n},element:function(e){if(e&&(e.pL||1==e.nodeType))return e},flatten:function(e){return p.map(e,function(e){return e&&e.pL?p.makeArray(e):e&&e.length?u.flatten(e):e})},textselect:function(e){p(document)[e?"unbind":"bind"]("selectstart",u.dontstart),$A.css(document,"MozUserSelect",e?"":"none"),document.unselectable=e?"off":"on"},dontstart:function(){return!1},callback:function(){}};u.callback.prototype={update:function(){i.drop&&this.available.length&&p.each(this.available,function(e){i.drop.locate(this,e)})}};var r=f.fixHooks.touchstart=f.fixHooks.touchmove=f.fixHooks.touchend=f.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(a,e){if(e){var n=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0]||null;n&&p.each(r.props,function(e,t){a[t]=n[t]});var t=$A.pointerPos(e);a.pageX=t.x,a.pageY=t.y}return a}};i.draginit=i.dragstart=i.dragend=u})(a=$A.internal),o=(i=a).event,d=o.special.drag,n=d.add,t=d.teardown,d.noBubble=!1,d.livekey="livedrag",d.add=function(e){n.apply(this,arguments);var t=i.data(this,d.datakey);!t.live&&e.selector&&(t.live=!0,o.add(this,"draginit."+d.livekey,d.delegate))},d.teardown=function(){t.apply(this,arguments);var e=i.data(this,d.datakey)||{};e.live&&(o.remove(this,"draginit."+d.livekey,d.delegate),e.live=!1)},d.delegate=function(a){var n,r=[],e=i.data(this,"events")||{};return i.each(e||[],function(e,t){0===e.indexOf("drag")&&i.each(t||[],function(e,t){(n=i(a.target).closest(t.selector,a.currentTarget)[0])&&(o.add(n,t.origType+"."+d.livekey,t.origHandler||t.handler,t.data),i.inArray(n,r)<0&&r.push(n))})}),!!r.length&&i(r).bind("dragend."+d.livekey,function(){o.remove(this,"."+d.livekey)})},function(u){u.fn.drop=function(e,t,a){var n="string"==typeof e?e:"",r=u.isFunction(e)?e:u.isFunction(t)?t:null;return 0!==n.indexOf("drop")&&(n="drop"+n),a=(e==r?t:a)||{},r?this.bind(n,a,r):this.trigger(n),this},u.drop=function(e){e=e||{},v.multi=!0===e.multi?1/0:!1===e.multi?1:isNaN(e.multi)?v.multi:e.multi,v.delay=e.delay||v.delay,v.tolerance=u.isFunction(e.tolerance)?e.tolerance:null===e.tolerance?null:v.tolerance,v.mode=e.mode||v.mode||"overlap"};var i=u.event,h=i.special,v=u.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",livekey:"livedrop",noBubble:!0,add:function(e){var t=u.data(this,v.datakey);t.related+=1,!t.live&&e.selector&&(t.live=!0,i.add(this,"dropinit."+v.livekey,v.delegate))},remove:function(){u.data(this,v.datakey).related-=1},setup:function(){u.data(this,v.datakey)||(u.data(this,v.datakey,{related:0,active:[],anyactive:0,winner:0,location:{}}),v.targets.push(this))},teardown:function(){if(!(u.data(this,v.datakey)||{}).related){u.removeData(this,v.datakey),i.remove(this,"dropinit",v.delegate);var t=this;v.targets=u.grep(v.targets,function(e){return e!==t})}},handler:function(e,t){var a;if(t)switch(e.type){case"mousedown":case"touchstart":a=u(v.targets),"string"==typeof t.drop&&(a=a.filter(t.drop)),a.each(function(){var e=u.data(this,v.datakey);e.active=[],e.anyactive=0,e.winner=0}),t.droppable=a,v.delegates=[],h.drag.hijack(e,"dropinit",t),v.delegates=u.unique(h.drag.flatten(v.delegates));break;case"mousemove":case"touchmove":v.event=e,v.timer||v.tolerate(t);break;case"mouseup":case"touchend":v.timer=clearTimeout(v.timer),t.propagates&&(h.drag.hijack(e,"drop",t),h.drag.hijack(e,"dropend",t),u.each(v.delegates||[],function(){i.remove(this,"."+v.livekey)}))}},delegate:function(a){var n,r=[],e=u.data(this,"events")||{};return u.each(e.live||[],function(e,t){0===t.preType.indexOf("drop")&&(n=u(a.currentTarget).find(t.selector)).length&&n.each(function(){i.add(this,t.origType+"."+v.livekey,t.origHandler,t.data),u.inArray(this,r)<0&&r.push(this)})}),v.delegates.push(r),!!r.length&&u(r)},locate:function(e,t){var a=u.data(e,v.datakey),n=$A.xOffset(e,!0),r={elem:e,width:n.width,height:n.height,top:n.top,left:n.left,right:n.right,bottom:n.bottom};return a&&(a.location=r,a.index=t,a.elem=e),r},contains:function(e,t){return(t[0]||t.left)>=e.left&&(t[0]||t.right)<=e.right&&(t[1]||t.top)>=e.top&&(t[1]||t.bottom)<=e.bottom},modes:{intersect:function(e,t,a){return this.contains(a,[e.pageX,e.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(e,t,a){return Math.max(0,Math.min(a.bottom,t.bottom)-Math.max(a.top,t.top))*Math.max(0,Math.min(a.right,t.right)-Math.max(a.left,t.left))},fit:function(e,t,a){return this.contains(a,t)?1:0},middle:function(e,t,a){return this.contains(a,[t.left+.5*t.width,t.top+.5*t.height])?1:0}},sort:function(e,t){return t.winner-e.winner||e.index-t.index},tolerate:function(e){var t,a,n,r,i,o,d,s,c=0,l=e.interactions.length,g=$A.pointerPos(v.event),p=[g.x,g.y],f=v.tolerance||v.modes[v.mode];do{if(s=e.interactions[c]){if(!s)return;s.drop=[],i=[],o=s.droppable.length,f&&(n=v.locate(s.proxy)),t=0;do{if(d=s.droppable[t]){if(!(a=(r=u.data(d,v.datakey)).location))continue;r.winner=f?f.call(v,v.event,n,a):v.contains(a,p)?1:0,i.push(r)}}while(++t<o);for(i.sort(v.sort),t=0;(r=i[t])&&(r.winner&&s.drop.length<v.multi?(r.active[c]||r.anyactive||(!1!==h.drag.hijack(v.event,"dropstart",e,c,r.elem)[0]?(r.active[c]=1,r.anyactive+=1):r.winner=0),r.winner&&s.drop.push(r.elem)):r.active[c]&&1==r.anyactive&&(h.drag.hijack(v.event,"dropend",e,c,r.elem),r.active[c]=0,r.anyactive-=1)),++t<o;);}}while(++c<l);v.last&&p[0]==v.last.pageX&&p[1]==v.last.pageY?delete v.timer:v.timer=setTimeout(function(){v.tolerate(e)},v.delay),v.last=v.event}};h.dropinit=h.dropstart=h.dropend=v}(a),c=(s=a).event,l=c.special.drop,r=l.add,g=l.teardown,l.noBubble=!1,l.livekey="livedrop",l.add=function(e){r.apply(this,arguments);var t=s.data(this,l.datakey);!t.live&&e.selector&&(t.live=!0,c.add(this,"dropinit."+l.livekey,l.delegate))},l.teardown=function(){g.apply(this,arguments);var e=s.data(this,l.datakey)||{};e.live&&(c.remove(this,"dropinit",l.delegate),e.live=!1)},l.delegate=function(a,e){var n,r=[],t=s.data(this,"events")||{};return s.each(t||[],function(e,t){0===e.indexOf("drop")&&s.each(t,function(e,t){(n=s(a.currentTarget).find(t.selector)).length&&n.each(function(){c.add(this,t.origType+"."+l.livekey,t.origHandler||t.handler,t.data),s.inArray(this,r)<0&&r.push(this)})})}),e&&c.add(e.drag,"dragend."+l.livekey,function(){s.each(r.concat(this),function(){c.remove(this,"."+l.livekey)})}),!!r.length&&s(r)},$A.setDragAndDrop=function(a){var n="tmp"+$A.genId(),r=a.ddCSS||{},i=a.cssObj||{},e=(a.on,a.root||document);$A.query(a.setDrag,e,function(e,t){$A.morph(t,{id:n+e,role:a.setName(t),showHiddenBounds:!1,showHiddenClose:!1,original:t,isDraggable:!0,drag:{confineTo:a.confineTo},accDD:{on:!0,dragText:a.dragText||"Drag",dropText:a.dropText||"Drop",actionText:a.actionText||"Dragging",dragLinkStyle:r,dropLinkStyle:r,dragClassName:a.dragClassName||"",dropClassName:a.dropClassName||"",dropAnchor:a.dropAnchor||"",duration:a.duration||1e3},onDragStart:a.on.dragStart,onDrag:a.on.drag,onDropStart:a.on.dropStart,onDrop:a.on.drop,onDropEnd:a.on.dropEnd,onDragEnd:a.on.dragEnd,dropTarget:a.setDrop,cssObj:i,displayInline:a.displayInline||!1,runBefore:function(e){a.runBefore&&a.runBefore.apply(e,[e])},runAfter:function(e){a.runAfter&&a.runAfter.apply(e,[e])}})})},$A.setDragAndDrop.setDrag=function(o,e,t){if(!(o=e[o.indexVal]).loading&&!o.loaded||o.fn.isDragSet)return o;o.fn.isDragSet=!0;var a={},d={};return o.drag.handle&&(a.handle=t(o.drag.handle).get(0)),"relative"==$A.css(o.accDCObj,"position")&&(a.relative=!0),o.drag.minDistance&&0<o.drag.minDistance&&(a.distance=o.drag.minDistance),o.drag.confineToN=null,t(o.accDCObj).drag("init",function(e,t){o.fn.isDragging=!0;var a=$A.xOffset(this,!1,!1,!0);if($A.css(this,a),"string"==typeof o.drag.confineTo?o.drag.confineToN=$A.query(o.drag.confineTo)[0]:o.drag.confineTo&&1===o.drag.confineTo.nodeType&&(o.drag.confineToN=o.drag.confineTo),o.drag.confineToN&&1===o.drag.confineToN.nodeType){d.nFixed=!1;var n=$A.css(this,"position"),r=$A.css(o.drag.confineToN,"position"),i=$A.xOffset(o.drag.confineToN,!0);"absolute"==n?(d.dAbsolute=!0,d.dFixed=d.dRelative=!1):"relative"==n?(d.dRelative=!0,d.dAbsolute=d.dFixed=!1):"fixed"==n&&(d.dFixed=!0,d.dAbsolute=d.dRelative=!1),d.dFixed&&"fixed"==r&&(d.nFixed=!0,i=$A.xOffset(o.drag.confineToN)),t.limit=i}$A.setAttr(o.accDCObj,"aria-grabbed","true"),o.drag.init&&"function"==typeof o.drag.init&&o.drag.init.apply(this,[e,t,o])}).drag("start",function(e,t){o.onDragStart.apply(this,[e,t,o])}).drag(function(e,t){if(d.y!=t.offsetY||d.x!=t.offsetX){if(o.drag.override&&"function"==typeof o.drag.override)o.drag.override.apply(this,[e,t,o]);else if(o.drag.confineToN&&1===o.drag.confineToN.nodeType){var a=!1,n=!1,r={top:t.offsetY,left:t.offsetX},i=$A.xOffset(this,!0);d.dFixed&&d.nFixed&&(i=$A.xOffset(this,!1,!1)),i.top<t.limit.top&&(d.dAbsolute||d.dFixed&&d.nFixed?r.top=t.limit.top:n=!0),i.bottom>t.limit.bottom&&(d.dAbsolute||d.dFixed&&d.nFixed?r.top=t.limit.bottom-i.height:n=!0),i.left<t.limit.left&&(d.dAbsolute||d.dFixed&&d.nFixed?r.left=t.limit.left:a=!0),i.right>t.limit.right&&(d.dAbsolute||d.dFixed&&d.nFixed?r.left=t.limit.right-i.width:a=!0),n||$A.xTop(this,r.top),a||$A.xLeft(this,r.left)}else"number"==typeof o.drag.maxX||"number"==typeof o.drag.maxY?("number"==typeof o.drag.maxX&&(t.originalX<t.offsetX&&t.offsetX-t.originalX<=o.drag.maxX||t.originalX>t.offsetX&&t.originalX-t.offsetX<=o.drag.maxX)&&$A.xLeft(this,t.offsetX),"number"==typeof o.drag.maxY&&(t.originalY<t.offsetY&&t.offsetY-t.originalY<=o.drag.maxY||t.originalY>t.offsetY&&t.originalY-t.offsetY<=o.drag.maxY)&&$A.xTop(this,t.offsetY)):($A.xTop(this,t.offsetY),$A.xLeft(this,t.offsetX));o.onDrag.apply(this,[e,t,o]),d.y=t.offsetY,d.x=t.offsetX}}).drag("end",function(e,t){o.fn.isDragging=!1,o.drag.y=t.offsetY,o.drag.x=t.offsetX,$A.setAttr(o.accDCObj,"aria-grabbed","false"),o.onDragEnd.apply(this,[e,t,o])},a),o.dropTarget&&(t(o.dropTarget).drop("init",function(e,t){o.fn.isDragging&&o.dropInit&&"function"==typeof o.dropInit&&o.dropInit.apply(this,[e,t,o])}).drop("start",function(e,t){o.fn.isDragging&&o.onDropStart.apply(this,[e,t,o])}).drop(function(e,t){o.fn.isDragging&&o.onDrop.apply(this,[e,t,o])}).drop("end",function(e,t){o.fn.isDragging&&o.onDropEnd.apply(this,[e,t,o])}),t.drop(o.drop),o.accDD.on&&(o.accDD.dropTargets=[],o.accDD.dropAnchors=[],o.accDD.dropLinks=[],$A.query(o.dropTarget,function(t,e){o.accDD.dropAnchors[t]=e,o.accDD.dropTargets[t]=e,$A.setAttr(e,"aria-dropeffect",o.accDD.dropEffect),o.accDD.dropLinks[t]=$A.createEl("a",{href:"#"},o.sraCSS,o.accDD.dragClassName,$A.createText(o.accDD.dragText+" "+o.role+" "+o.accDD.toText+" "+$A.getAttr(e,"data-label"))),o.containerDiv.appendChild(o.accDD.dropLinks[t]),$A.bind(o.accDD.dropLinks[t],{focus:function(e){$A.css($A.sraCSSClear(this),{position:"relative",zIndex:1e3},o.accDD.dragLinkStyle)},blur:function(e){$A.css(this,o.sraCSS)},click:function(e){o.accDD.isDragging||(o.accDD.isDragging=!0,$A.css(this,o.sraCSS),$A.setAttr(o.accDCObj,"aria-grabbed","true"),$A.announce(o.accDD.actionText),o.accDD.fireDrag.apply(o.accDCObj,[e,o]),o.accDD.fireDrop.apply(o.accDD.dropTargets[t],[e,o])),e.preventDefault()}})}),$A.setAttr(o.accDCObj,"aria-grabbed","false"))),e[o.indexVal]=o},$A.setDragAndDrop.unsetDrag=function(e,t,a,n){return(e=a[e.indexVal]).closing||e.loaded?($A.unbind(e.drag.handle?e.drag.handle:e.accDCObj,"draginit dragstart dragend drag"),$A.remAttr(e.accDCObj,"aria-grabbed"),e.dropTarget&&(t&&($A.unbind(e.dropTarget,"dropinit dropstart dropend drop"),$A.query(e.dropTarget,function(e,t){$A.remAttr(t,"aria-dropeffect")})),e.accDD.on&&n.each(e.accDD.dropLinks,function(e,t){t.parentNode&&t.parentNode.removeChild(t)})),e.fn.isDragSet=!1,a[e.indexVal]=e):e}}();