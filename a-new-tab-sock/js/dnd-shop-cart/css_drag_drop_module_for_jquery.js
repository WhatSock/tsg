/*
CSS Drag and Drop Module R2.5 for jQuery
(Requires AccDC API version 3.4+> )
Copyright 2010-2017 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
*/
(function(){(function(a){(function(h){h.fn.drag=function(n,j,m){var l=typeof n=="string"?n:"",k=h.isFunction(n)?n:h.isFunction(j)?j:null;if(l.indexOf("drag")!==0){l="drag"+l}m=(n==k?j:m)||{};return k?this.bind(l,m,k):this.trigger(l)};if(!h.event.fixHooks){var c=function(){var l=jQuery.fn.load,j=jQuery.event.add,k=jQuery.event.fix;jQuery.event.props=[];jQuery.event.fixHooks={};jQuery.event.fix=function(m){var p,o=m.type,q=this.fixHooks[o],n=jQuery.event.props;if(n.length){while(n.length){jQuery.event.addProp(n.pop())}}if(q&&!q._migrated_){q._migrated_=true;if((n=q.props)&&n.length){while(n.length){jQuery.event.addProp(n.pop())}}}p=k.call(this,m);return q&&q.filter?q.filter(p,m):p};jQuery.event.add=function(n,m){if(n===window&&m==="load"&&window.document.readyState==="complete"){}return j.apply(this,arguments)};jQuery.each(["load","unload","error"],function(n,m){jQuery.fn[m]=function(){var o=Array.prototype.slice.call(arguments,0);if(m==="load"&&typeof o[0]==="string"){return l.apply(this,o)}o.splice(0,0,m);if(arguments.length){return this.on.apply(this,o)}this.triggerHandler.apply(this,o);return this}});jQuery(function(){jQuery(window.document).triggerHandler("ready")});jQuery.event.special.ready={setup:function(){if(this===window.document){}}};jQuery.fn.extend({bind:function(m,o,n){return this.on(m,null,o,n)},unbind:function(m,n){return this.off(m,null,n)},delegate:function(m,n,p,o){return this.on(n,m,p,o)},undelegate:function(m,n,o){return arguments.length===1?this.off(m,"**"):this.off(n,m||"**",o)}})};c()}var e=h.event,b=e.special,g=b.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:false,drop:true,click:false},datakey:"dragdata",noBubble:true,add:function(l){var k=h.data(this,g.datakey),j=l.data||{};k.related+=1;h.each(g.defaults,function(m,n){if(j[m]!==undefined){k[m]=j[m]}})},remove:function(){h.data(this,g.datakey).related-=1},setup:function(){if(h.data(this,g.datakey)){return}var j=h.extend({related:0},g.defaults);h.data(this,g.datakey,j);e.add(this,"touchstart mousedown",g.init,j);if(this.attachEvent){this.attachEvent("ondragstart",g.dontstart)}},teardown:function(){var j=h.data(this,g.datakey)||{};if(j.related){return}h.removeData(this,g.datakey);e.remove(this,"touchstart mousedown",g.init);g.textselect(true);if(this.detachEvent){this.detachEvent("ondragstart",g.dontstart)}},init:function(l){if(g.touched){return}var j=l.data,k;if(l.which!=0&&j.which>0&&l.which!=j.which){return}if(h(l.target).is(j.not)){return}if(j.handle&&!h(l.target).closest(j.handle,l.currentTarget).length){return}g.touched=l.type=="touchstart"?this:null;j.propagates=1;j.mousedown=this;j.interactions=[g.interaction(this,j)];j.target=l.target;j.pageX=l.pageX;j.pageY=l.pageY;j.dragging=null;k=g.hijack(l,"draginit",j);if(!j.propagates){return}k=g.flatten(k);if(k&&k.length){j.interactions=[];h.each(k,function(){j.interactions.push(g.interaction(this,j))})}j.propagates=j.interactions.length;if(j.drop!==false&&b.drop){b.drop.handler(l,j)}g.textselect(false);if(g.touched){e.add(g.touched,"touchmove touchend",g.handler,j)}else{e.add(document,"mousemove mouseup",g.handler,j)}if(!g.touched||j.live){return false}},interaction:function(k,j){var l=$A.xOffset(k);return{drag:k,callback:new g.callback(),droppable:[],offset:l}},handler:function(k){var j=k.data;switch(k.type){case !j.dragging&&"touchmove":k.preventDefault();case !j.dragging&&"mousemove":if(Math.pow(k.pageX-j.pageX,2)+Math.pow(k.pageY-j.pageY,2)<Math.pow(j.distance,2)){break}k.target=j.target;g.hijack(k,"dragstart",j);if(j.propagates){j.dragging=true}case"touchmove":k.preventDefault();case"mousemove":if(j.dragging){g.hijack(k,"drag",j);if(j.propagates){if(j.drop!==false&&b.drop){b.drop.handler(k,j)}break}k.type="mouseup"}case"touchend":case"mouseup":default:if(g.touched){e.remove(g.touched,"touchmove touchend",g.handler)}else{e.remove(document,"mousemove mouseup",g.handler)}if(j.dragging){if(j.drop!==false&&b.drop){b.drop.handler(k,j)}g.hijack(k,"dragend",j)}g.textselect(true);if(j.click===false&&j.dragging){h.data(j.mousedown,"suppress.click",new Date().getTime()+5)}j.dragging=g.touched=false;break}},hijack:function(k,q,t,r,m){if(!t){return}var s={event:k.originalEvent,type:k.type},o=q.indexOf("drop")?"drag":"drop",v,n=r||0,l,j,u,p=!isNaN(r)?r:t.interactions.length;k.type=q;t.results=[];do{if(l=t.interactions[n]){if(q!=="dragend"&&l.cancelled){continue}u=g.properties(k,t,l);l.results=[];h(m||l[o]||t.droppable).each(function(x,w){u.target=w;k.isPropagationStopped=function(){return false};v=w?e.dispatch.call(w,k,u):null;if(v===false){if(o=="drag"){l.cancelled=true;t.propagates-=1}if(q=="drop"){l[o][x]=null}}else{if(q=="dropinit"){l.droppable.push(g.element(v)||w)}}if(q=="dragstart"){l.proxy=h(g.element(v)||l.drag)[0]}l.results.push(v);delete k.result;if(q!=="dropinit"){return v}});t.results[n]=g.flatten(l.results);if(q=="dropinit"){l.droppable=g.flatten(l.droppable)}if(q=="dragstart"&&!l.cancelled){u.update()}}}while(++n<p);k.type=s.type;k.originalEvent=s.event;return g.flatten(t.results)},properties:function(l,j,k){var m=k.callback;m.drag=k.drag;m.proxy=k.proxy||k.drag;m.startX=j.pageX;m.startY=j.pageY;m.deltaX=l.pageX-j.pageX;m.deltaY=l.pageY-j.pageY;m.originalX=k.offset.left;m.originalY=k.offset.top;m.offsetX=m.originalX+m.deltaX;m.offsetY=m.originalY+m.deltaY;m.drop=g.flatten((k.drop||[]).slice());m.available=g.flatten((k.droppable||[]).slice());return m},element:function(j){if(j&&(j.jquery||j.nodeType==1)){return j}},flatten:function(j){return h.map(j,function(k){return k&&k.jquery?h.makeArray(k):k&&k.length?g.flatten(k):k})},textselect:function(j){h(document)[j?"unbind":"bind"]("selectstart",g.dontstart);$A.css(document,"MozUserSelect",j?"":"none");document.unselectable=j?"off":"on"},dontstart:function(){return false},callback:function(){}};g.callback.prototype={update:function(){if(b.drop&&this.available.length){h.each(this.available,function(j){b.drop.locate(this,j)})}}};var i=e.dispatch;e.dispatch=function(j){if(h.data(this,"suppress."+j.type)-new Date().getTime()>0){h.removeData(this,"suppress."+j.type);return}return i.apply(this,arguments)};var f=e.fixHooks.touchstart=e.fixHooks.touchmove=e.fixHooks.touchend=e.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(k,l){if(l){var j=(l.touches&&l.touches[0])||(l.changedTouches&&l.changedTouches[0])||null;if(j){h.each(f.props,function(m,n){k[n]=j[n]})}}return k}};var d=e.fixHooks.mousedown=e.fixHooks.mousemove=e.fixHooks.mouseup={props:("button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement").split(" "),filter:function(n,m){var j,o,p,l=m.button,q=m.fromElement;if(n.pageX==null&&(m.clientX!=null||m.pageX!=null)){var k=$A.pointerPos(m);n.pageX=k.x;n.pageY=k.y;o=n.target.ownerDocument||document;p=o.documentElement;j=o.body}if(!n.relatedTarget&&q){n.relatedTarget=q===n.target?m.toElement:q}if(!n.which&&l!==undefined){n.which=(l&1?1:(l&2?3:(l&4?2:0)))}return n}};b.draginit=b.dragstart=b.dragend=g})(a);(function(e){var c=e.event,d=c.special.drag,b=d.add,f=d.teardown;d.noBubble=false;d.livekey="livedrag";d.add=function(h){b.apply(this,arguments);var g=e.data(this,d.datakey);if(!g.live&&h.selector){g.live=true;c.add(this,"draginit."+d.livekey,d.delegate)}};d.teardown=function(){f.apply(this,arguments);var g=e.data(this,d.datakey)||{};if(g.live){c.remove(this,"draginit."+d.livekey,d.delegate);g.live=false}};d.delegate=function(i){var g=[],j,h=e.data(this,"events")||{};e.each(h||[],function(l,k){if(l.indexOf("drag")!==0){return}e.each(k||[],function(m,n){j=e(i.target).closest(n.selector,i.currentTarget)[0];if(!j){return}c.add(j,n.origType+"."+d.livekey,n.origHandler||n.handler,n.data);if(e.inArray(j,g)<0){g.push(j)}})});if(!g.length){return false}return e(g).bind("dragend."+d.livekey,function(){c.remove(this,"."+d.livekey)})}})(a);(function(e){e.fn.drop=function(j,f,i){var h=typeof j=="string"?j:"",g=e.isFunction(j)?j:e.isFunction(f)?f:null;if(h.indexOf("drop")!==0){h="drop"+h}i=(j==g?f:i)||{};return g?this.bind(h,i,g):this.trigger(h)};e.drop=function(f){f=f||{};c.multi=f.multi===true?Infinity:f.multi===false?1:!isNaN(f.multi)?f.multi:c.multi;c.delay=f.delay||c.delay;c.tolerance=e.isFunction(f.tolerance)?f.tolerance:f.tolerance===null?null:c.tolerance;c.mode=f.mode||c.mode||"intersect"};var d=e.event,b=d.special,c=e.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:true,add:function(g){var f=e.data(this,c.datakey);f.related+=1},remove:function(){e.data(this,c.datakey).related-=1},setup:function(){if(e.data(this,c.datakey)){return}var f={related:0,active:[],anyactive:0,winner:0,location:{}};e.data(this,c.datakey,f);c.targets.push(this)},teardown:function(){var g=e.data(this,c.datakey)||{};if(g.related){return}e.removeData(this,c.datakey);var f=this;c.targets=e.grep(c.targets,function(h){return(h!==f)})},handler:function(h,f){var g,i;if(!f){return}switch(h.type){case"mousedown":case"touchstart":i=e(c.targets);if(typeof f.drop=="string"){i=i.filter(f.drop)}i.each(function(){var j=e.data(this,c.datakey);j.active=[];j.anyactive=0;j.winner=0});f.droppable=i;b.drag.hijack(h,"dropinit",f);break;case"mousemove":case"touchmove":c.event=h;if(!c.timer){c.tolerate(f)}break;case"mouseup":case"touchend":c.timer=clearTimeout(c.timer);if(f.propagates){b.drag.hijack(h,"drop",f);b.drag.hijack(h,"dropend",f)}break}},locate:function(j,h){var k=e.data(j,c.datakey),g=e(j),i=$A.xOffset(j,true);var f={elem:j,width:i.width,height:i.height,top:i.top,left:i.left,right:i.right,bottom:i.bottom};if(k){k.location=f;k.index=h;k.elem=j}return f},contains:function(f,g){return((g[0]||g.left)>=f.left&&(g[0]||g.right)<=f.right&&(g[1]||g.top)>=f.top&&(g[1]||g.bottom)<=f.bottom)},modes:{intersect:function(g,f,h){return this.contains(h,[g.pageX,g.pageY])?1000000000:this.modes.overlap.apply(this,arguments)},overlap:function(g,f,h){return Math.max(0,Math.min(h.bottom,f.bottom)-Math.max(h.top,f.top))*Math.max(0,Math.min(h.right,f.right)-Math.max(h.left,f.left))},fit:function(g,f,h){return this.contains(h,f)?1:0},middle:function(g,f,h){return this.contains(h,[f.left+f.width*0.5,f.top+f.height*0.5])?1:0}},sort:function(g,f){return(f.winner-g.winner)||(g.index-f.index)},tolerate:function(r){var l,f,o,k,m,n,h,q=0,g,j=r.interactions.length,s=$A.pointerPos(c.event),t=[s.x,s.y],p=c.tolerance||c.modes[c.mode];do{if(g=r.interactions[q]){if(!g){return}g.drop=[];m=[];n=g.droppable.length;if(p){o=c.locate(g.proxy)}l=0;do{if(h=g.droppable[l]){k=e.data(h,c.datakey);f=k.location;if(!f){continue}k.winner=p?p.call(c,c.event,o,f):c.contains(f,t)?1:0;m.push(k)}}while(++l<n);m.sort(c.sort);l=0;do{if(k=m[l]){if(k.winner&&g.drop.length<c.multi){if(!k.active[q]&&!k.anyactive){if(b.drag.hijack(c.event,"dropstart",r,q,k.elem)[0]!==false){k.active[q]=1;k.anyactive+=1}else{k.winner=0}}if(k.winner){g.drop.push(k.elem)}}else{if(k.active[q]&&k.anyactive==1){b.drag.hijack(c.event,"dropend",r,q,k.elem);k.active[q]=0;k.anyactive-=1}}}}while(++l<n)}}while(++q<j);if(c.last&&t[0]==c.last.pageX&&t[1]==c.last.pageY){delete c.timer}else{c.timer=setTimeout(function(){c.tolerate(r)},c.delay)}c.last=c.event}};b.dropinit=b.dropstart=b.dropend=c})(a);(function(e){var d=e.event,b=d.special.drop,c=b.add,f=b.teardown;b.noBubble=false;b.livekey="livedrop";b.add=function(h){c.apply(this,arguments);var g=e.data(this,b.datakey);if(!g.live&&h.selector){g.live=true;d.add(this,"dropinit."+b.livekey,b.delegate)}};b.teardown=function(){f.apply(this,arguments);var g=e.data(this,b.datakey)||{};if(g.live){d.remove(this,"dropinit",b.delegate);g.live=false}};b.delegate=function(j,g){var h=[],k,i=e.data(this,"events")||{};e.each(i||[],function(m,l){if(m.indexOf("drop")!==0){return}e.each(l,function(n,o){k=e(j.currentTarget).find(o.selector);if(!k.length){return}k.each(function(){d.add(this,o.origType+"."+b.livekey,o.origHandler||o.handler,o.data);if(e.inArray(this,h)<0){h.push(this)}})})});if(g){d.add(g.drag,"dragend."+b.livekey,function(){e.each(h.concat(this),function(){d.remove(this,"."+b.livekey)})})}return h.length?e(h):false}})(a)})($A.internal);$A.setDragAndDrop=function(c){var f="tmp"+$A.genId(),d=c.ddCSS||{},e=c.cssObj||{},b=c.on||{},a=c.root||document;$A.query(c.setDrag,a,function(g,h){$A.morph(h,{id:f+g,role:c.setName(h),showHiddenBounds:false,showHiddenClose:false,original:h,isDraggable:true,drag:{confineTo:c.confineTo},accDD:{on:true,dragText:c.dragText||"Drag",dropText:c.dropText||"Drop",actionText:c.actionText||"Dragging",dragLinkStyle:d,dropLinkStyle:d,dragClassName:c.dragClassName||"",dropClassName:c.dropClassName||"",dropAnchor:c.dropAnchor||"",duration:c.duration||1000},onDragStart:c.on.dragStart,onDrag:c.on.drag,onDropStart:c.on.dropStart,onDrop:c.on.drop,onDropEnd:c.on.dropEnd,onDragEnd:c.on.dragEnd,dropTarget:c.setDrop,cssObj:e,displayInline:c.displayInline||false,runBefore:function(i){if(c.runBefore){c.runBefore.apply(i,[i])}},runAfter:function(i){if(c.runAfter){c.runAfter.apply(i,[i])}}})})};$A.setDragAndDrop.setDrag=function(a,b,c){var a=b[a.indexVal];if((!a.loading&&!a.loaded)||a.fn.isDragSet){return a}a.fn.isDragSet=true;var e={},d={};if(a.drag.handle){e.handle=c(a.drag.handle).get(0)}if($A.css(a.accDCObj,"position")=="relative"){e.relative=true}if(a.drag.minDistance&&a.drag.minDistance>0){e.distance=a.drag.minDistance}a.drag.confineToN=null;c(a.accDCObj).drag("init",function(i,f){a.fn.isDragging=true;var k=$A.xOffset(this,false,false,true);$A.css(this,k);if(typeof a.drag.confineTo==="string"){a.drag.confineToN=$A.query(a.drag.confineTo)[0]}else{if(a.drag.confineTo&&a.drag.confineTo.nodeType===1){a.drag.confineToN=a.drag.confineTo}}if(a.drag.confineToN&&a.drag.confineToN.nodeType===1){d.nFixed=false;var g=$A.css(this,"position"),h=$A.css(a.drag.confineToN,"position"),j=$A.xOffset(a.drag.confineToN,true);if(g=="absolute"){d.dAbsolute=true;d.dFixed=d.dRelative=false}else{if(g=="relative"){d.dRelative=true;d.dAbsolute=d.dFixed=false}else{if(g=="fixed"){d.dFixed=true;d.dAbsolute=d.dRelative=false}}}if(d.dFixed&&h=="fixed"){d.nFixed=true;j=$A.xOffset(a.drag.confineToN)}f.limit=j}$A.setAttr(a.accDCObj,"aria-grabbed","true");if(a.drag.init&&typeof a.drag.init==="function"){a.drag.init.apply(this,[i,f,a])}}).drag("start",function(g,f){a.onDragStart.apply(this,[g,f,a])}).drag(function(h,f){if(d.y!=f.offsetY||d.x!=f.offsetX){if(a.drag.override&&typeof a.drag.override==="function"){a.drag.override.apply(this,[h,f,a])}else{if(a.drag.confineToN&&a.drag.confineToN.nodeType===1){var g=false,i=false,k={top:f.offsetY,left:f.offsetX},j=$A.xOffset(this,true);if(d.dFixed&&d.nFixed){j=$A.xOffset(this,false,false)}if(j.top<f.limit.top){if(d.dAbsolute||(d.dFixed&&d.nFixed)){k.top=f.limit.top}else{i=true}}if(j.bottom>f.limit.bottom){if(d.dAbsolute||(d.dFixed&&d.nFixed)){k.top=f.limit.bottom-j.height}else{i=true}}if(j.left<f.limit.left){if(d.dAbsolute||(d.dFixed&&d.nFixed)){k.left=f.limit.left}else{g=true}}if(j.right>f.limit.right){if(d.dAbsolute||(d.dFixed&&d.nFixed)){k.left=f.limit.right-j.width}else{g=true}}if(!i){$A.xTop(this,k.top)}if(!g){$A.xLeft(this,k.left)}}else{if(typeof a.drag.maxX==="number"||typeof a.drag.maxY==="number"){if(typeof a.drag.maxX==="number"&&((f.originalX<f.offsetX&&(f.offsetX-f.originalX)<=a.drag.maxX)||(f.originalX>f.offsetX&&(f.originalX-f.offsetX)<=a.drag.maxX))){$A.xLeft(this,f.offsetX)}if(typeof a.drag.maxY==="number"&&((f.originalY<f.offsetY&&(f.offsetY-f.originalY)<=a.drag.maxY)||(f.originalY>f.offsetY&&(f.originalY-f.offsetY)<=a.drag.maxY))){$A.xTop(this,f.offsetY)}}else{$A.xTop(this,f.offsetY);$A.xLeft(this,f.offsetX)}}}a.onDrag.apply(this,[h,f,a]);d.y=f.offsetY;d.x=f.offsetX}}).drag("end",function(g,f){a.fn.isDragging=false;a.drag.y=f.offsetY;a.drag.x=f.offsetX;$A.setAttr(a.accDCObj,"aria-grabbed","false");a.onDragEnd.apply(this,[g,f,a])},e);if(a.dropTarget){c(a.dropTarget).drop("init",function(g,f){if(a.fn.isDragging){if(a.dropInit&&typeof a.dropInit==="function"){a.dropInit.apply(this,[g,f,a])}}}).drop("start",function(g,f){if(a.fn.isDragging){a.onDropStart.apply(this,[g,f,a])}}).drop(function(g,f){if(a.fn.isDragging){a.onDrop.apply(this,[g,f,a])}}).drop("end",function(g,f){if(a.fn.isDragging){a.onDropEnd.apply(this,[g,f,a])}});c.drop(a.drop);if(a.accDD.on){a.accDD.dropTargets=[];a.accDD.dropAnchors=[];a.accDD.dropLinks=[];$A.query(a.dropTarget,function(g,f){a.accDD.dropAnchors[g]=f;a.accDD.dropTargets[g]=f;$A.setAttr(f,"aria-dropeffect",a.accDD.dropEffect);a.accDD.dropLinks[g]=$A.createEl("a",{href:"#"},a.sraCSS,a.accDD.dragClassName,$A.createText(a.accDD.dragText+" "+a.role+" "+a.accDD.toText+" "+$A.getAttr(f,"data-label")));a.containerDiv.appendChild(a.accDD.dropLinks[g]);$A.bind(a.accDD.dropLinks[g],{focus:function(h){$A.css($A.sraCSSClear(this),{position:"relative",zIndex:1000},a.accDD.dragLinkStyle)},blur:function(h){$A.css(this,a.sraCSS)},click:function(h){if(!a.accDD.isDragging){a.accDD.isDragging=true;$A.css(this,a.sraCSS);$A.setAttr(a.accDCObj,"aria-grabbed","true");$A.announce(a.accDD.actionText);a.accDD.fireDrag.apply(a.accDCObj,[h,a]);a.accDD.fireDrop.apply(a.accDD.dropTargets[g],[h,a])}h.preventDefault()}})});$A.setAttr(a.accDCObj,"aria-grabbed","false")}}return b[a.indexVal]=a};$A.setDragAndDrop.unsetDrag=function(a,d,b,c){var a=b[a.indexVal];if(!a.closing&&!a.loaded){return a}$A.unbind(a.drag.handle?a.drag.handle:a.accDCObj,"draginit dragstart dragend drag");$A.remAttr(a.accDCObj,"aria-grabbed");if(a.dropTarget){if(d){$A.unbind(a.dropTarget,"dropinit dropstart dropend drop");$A.query(a.dropTarget,function(f,e){$A.remAttr(e,"aria-dropeffect")})}if(a.accDD.on){c.each(a.accDD.dropLinks,function(f,e){if(e.parentNode){e.parentNode.removeChild(e)}})}}a.fn.isDragSet=false;return b[a.indexVal]=a}})();